<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>STEM Tutoring Interaction Panel</title>
    <style>
      :root {
        --primary-color: #4a90e2;
        --primary-color-dark: #357abd;
        --background-color: #f0f4fa;
        --text-color: #222;
        --shadow-light: rgba(74, 144, 226, 0.25);
        --shadow-strong: rgba(74, 144, 226, 0.45);
        --transition-speed: 0.3s;
        --font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        font-family: var(--font-family);
        max-width: 700px;
        margin: 20px auto;
        padding: 10px;
        background-color: var(--background-color);
        color: var(--text-color);
        user-select: none;
      }

      h2 {
        color: var(--primary-color-dark);
        font-weight: 700;
      }

      textarea {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        resize: vertical;
        border-radius: 6px;
        border: 1.5px solid #a8b9d9;
        box-sizing: border-box;
        font-family: var(--font-family);
        color: var(--text-color);
        transition: border-color var(--transition-speed);
      }

      textarea:focus {
        outline: none;
        border-color: var(--primary-color-dark);
        box-shadow: 0 0 8px var(--shadow-light);
      }

      button {
        margin-top: 10px;
        padding: 12px 26px;
        font-size: 16px;
        cursor: pointer;
        border-radius: 8px;
        border: none;
        background-color: var(--primary-color);
        color: white;
        transition: background-color var(--transition-speed);
        font-weight: 700;
        user-select: auto;
      }

      button:hover,
      button:focus {
        background-color: var(--primary-color-dark);
        outline: none;
      }

      section {
        margin-top: 25px;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 6px 16px var(--shadow-light);
        background-color: white;
      }

      #feedback {
        border-left: 8px solid #4caf50;
        color: #2e7d32;
        display: none;
      }

      #explanation {
        border-left: 8px solid var(--primary-color);
        white-space: pre-wrap;
        color: var(--primary-color-dark);
        display: none;
      }

      #hints {
        border-left: 8px solid #ffb300;
        text-align: center;
        user-select: none;
        color: #a66500;
        display: none;
      }

      #reasoningPath {
        border-left: 8px solid #9c27b0;
        margin-top: 15px;
        max-height: 0;
        overflow: hidden;
        transition: max-height var(--transition-speed) ease;
        white-space: pre-wrap;
        background-color: #ede8f8;
        padding: 0 15px;
        border-radius: 0 0 8px 8px;
        color: #6a1b9a;
        font-family: monospace;
        font-size: 0.95rem;
        user-select: text;
      }

      #reasoningToggle {
        cursor: pointer;
        color: #9c27b0;
        font-weight: 700;
        margin-top: 14px;
        user-select: none;
        outline-offset: 4px;
      }

      #reasoningToggle:focus {
        outline: 2px dashed #9c27b0;
        outline-offset: 6px;
      }

      #historyList {
        list-style-type: decimal;
        padding-left: 20px;
        max-height: 160px;
        overflow-y: auto;
        border: 1px solid #cbd3e8;
        border-radius: 6px;
        margin-top: 12px;
        background-color: white;
        color: var(--text-color);
        font-size: 0.9rem;
        user-select: text;
      }

      #historyList li {
        margin-bottom: 8px;
        word-wrap: break-word;
      }

      label.multi-modal-label {
        display: inline-block;
        margin-top: 12px;
        margin-bottom: 8px;
        font-weight: 600;
        color: #506690;
        user-select: text;
      }

      @media (max-width: 480px) {
        button {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <h2>STEM Tutoring Interaction Panel</h2>

    <form id="tutorForm">
      <label for="studentAnswer" class="multi-modal-label"
        >Enter your answer or question (text, formula, code):</label
      >
      <textarea
        id="studentAnswer"
        rows="5"
        placeholder="Type your solution, equation, code snippet, or question here..."
      ></textarea>
      <button type="submit" aria-label="Submit answer or question">
        Submit
      </button>
    </form>

    <section id="feedback" aria-live="polite" aria-atomic="true">
      <h3>Feedback</h3>
      <p id="feedbackText"></p>
    </section>

    <section id="explanation" aria-live="polite" aria-atomic="true">
      <h3>Explanation & Reasoning</h3>
      <p id="explanationText"></p>
    </section>

    <section id="hints" role="region" aria-live="polite" aria-atomic="true">
      <h3>Hints (Step <span id="hintStep">1</span> of 3)</h3>
      <p id="hintText"></p>
      <button id="nextHintButton" aria-label="Show next hint">Next Hint</button>
    </section>

    <section aria-label="Symbolic reasoning path and logic visualization">
      <div
        id="reasoningToggle"
        tabindex="0"
        role="button"
        aria-expanded="false"
        aria-controls="reasoningPath"
      >
        Show Symbolic Reasoning Path ▼
      </div>
      <pre id="reasoningPath">
Step 1: Identify known quantities.
Step 2: Apply Newton's Second Law F = ma.
Step 3: Calculate missing values and verify units.
Step 4: Validate solution with symbolic rules.
      </pre>
    </section>

    <section aria-label="Student input submission history">
      <h3>Your Recent Submissions</h3>
      <ul id="historyList" aria-live="polite" aria-relevant="additions"></ul>
    </section>

    <script>
      const form = document.getElementById("tutorForm");
      const studentInput = document.getElementById("studentAnswer");
      const feedback = document.getElementById("feedback");
      const feedbackText = document.getElementById("feedbackText");
      const explanationSection = document.getElementById("explanation");
      const explanationText = document.getElementById("explanationText");
      const hintSection = document.getElementById("hints");
      const hintText = document.getElementById("hintText");
      const nextHintButton = document.getElementById("nextHintButton");
      const hintStep = document.getElementById("hintStep");
      const reasoningToggle = document.getElementById("reasoningToggle");
      const reasoningPath = document.getElementById("reasoningPath");
      const historyList = document.getElementById("historyList");

      const hints = [
        "Remember the formula for acceleration: a = Δv / Δt.",
        "Check your units carefully to maintain consistency.",
        "Break complex problems into smaller sub-problems.",
      ];

      let hintIndex = 0;
      let history = [];
      let hintCache = [];

      // Function to provide feedback and explanation locally or via API call
      function getFeedbackAndExplanation(input) {
        if (!input.trim()) {
          feedbackText.textContent = "Please enter your answer.";
          explanationText.textContent = "";
          feedback.style.display = "block";
          explanationSection.style.display = "none";
          hintSection.style.display = "none";
          return;
        }
        // Example local logic - replace or extend with calls to backend AI API as needed
        if (input.toLowerCase().includes("force")) {
          feedbackText.textContent =
            "Good attempt! Your answer relates to force.";
          explanationText.textContent =
            "This reasoning is based on Newton's Second Law: F = ma.\nMake sure to substitute values correctly and consider the direction of forces.";
        } else if (input.toLowerCase().includes("acceleration")) {
          feedbackText.textContent = "Nice try! Acceleration is key here.";
          explanationText.textContent =
            "Acceleration is the rate of change of velocity with respect to time.\nRelate this to the forces acting on the object.";
        } else {
          feedbackText.textContent =
            "Answer not recognized. Try considering the forces acting on the object or related quantities.";
          explanationText.textContent =
            "Hint: Think about how forces and acceleration affect motion according to physics principles.";
        }
        feedback.style.color = "black";
        feedback.style.display = "block";
        explanationSection.style.display = "block";
        hintSection.style.display = "block";
        hintCache = hints;
        hintIndex = 0;
        hintText.textContent = hintCache[hintIndex];
        hintStep.textContent = hintIndex + 1;
      }

      // Show next hint adapted to current state
      function showNextHint() {
        if (hintCache.length === 0) {
          hintSection.style.display = "none";
          return;
        }
        hintIndex++;
        if (hintIndex < hintCache.length) {
          hintText.textContent = hintCache[hintIndex];
          hintStep.textContent = hintIndex + 1;
        } else {
          hintText.innerHTML = "<strong>No more hints available.</strong>";
        }
      }

      // Toggle symbolic reasoning visibility
      function toggleReasoningPath() {
        const expanded =
          reasoningToggle.getAttribute("aria-expanded") === "true";
        if (expanded) {
          reasoningPath.style.maxHeight = "0";
          reasoningToggle.setAttribute("aria-expanded", "false");
          reasoningToggle.textContent = "Show Symbolic Reasoning Path ▼";
        } else {
          reasoningPath.style.maxHeight = reasoningPath.scrollHeight + "px";
          reasoningToggle.setAttribute("aria-expanded", "true");
          reasoningToggle.textContent = "Hide Symbolic Reasoning Path ▲";
        }
      }

      // Update input history display
      function updateHistory(input) {
        history.unshift(input);
        if (history.length > 10) history.pop();
        historyList.innerHTML = "";
        history.forEach((entry) => {
          const li = document.createElement("li");
          li.textContent = entry;
          historyList.appendChild(li);
        });
      }

      // Event listeners
      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const inputVal = studentInput.value.trim();
        if (inputVal) {
          getFeedbackAndExplanation(inputVal);
          updateHistory(inputVal);
          studentInput.value = "";
        }
      });

      nextHintButton.addEventListener("click", showNextHint);

      reasoningToggle.addEventListener("click", toggleReasoningPath);
      reasoningToggle.addEventListener("keypress", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleReasoningPath();
        }
      });

      // Initialize UI
      hintText.textContent = hints[hintIndex];
      hintStep.textContent = hintIndex + 1;
      reasoningPath.style.maxHeight = "0";
    </script>
  </body>
</html>
